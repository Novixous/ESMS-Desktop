<TaskItem>:
  text: self.task.name
  _txt_bot_pad: 22

  IconLeftWidget:
    icon: "plus"
    on_release:
      root.add_task_to_session()

<KSheetLabel>:
  size_hint_x: None
  width: content.width

  canvas.before:
    Color:
      rgba: hex("#90A4AE") if root.state == "inactive" else hex("#FFFFFF")
    Rectangle:
      pos: self.pos
      size: self.size
    Color:
      rgba: hex("#EEEEEE") if root.state == "inactive" else hex("#37474F")
    Line:
      width: 0.5
      points: [root.width + root.x, 0, root.width + root.x, root.height]
    Line:
      width: 0.5
      points: [root.x, 0, root.x, root.height]

  Widget:
    id: content
    width: labeltext.texture_size[0] + 80

    KSheetLabelText:
      id: labeltext
      klabel: root
      text_size: (None, None)
      center_x: self.parent.center_x - 15
      center_y: self.parent.center_y
      theme_text_color: "Custom"
      text_color: hex("#FFFFFF") if root.state == "inactive" else hex("#607D8B")
      markup: True
      text: root.text if root.state == "inactive" else ("[b]" + root.text + "[/b]")

    MDIconButton:
      id: closebutton
      icon: "close"
      center_y: self.parent.center_y
      right: self.parent.right
      theme_text_color: "Custom"
      text_color: hex("#FFFFFF") if root.state == "inactive" else hex("#607D8B")
      on_release:
        app.tasksheets.remove_session_task(root.ksheet.session_task.stid)
        root.remove()

<TaskSheetBase>:

  ScrollView:
    scroll_type: ["bars", "content"]

    MDList:
      padding: [50, 0, 50, 0]

      MDLabel:
        size_hint: [1, None]
        font_style: "H6"
        height: 60
        text_size: (None, None)
        markup: True
        text: "[u]Sender Information[/u]"

      BoxLayout:
        size_hint: [1, None]
        height: 60

        BoxLayout:
          size_hint: [1, None]
          height: 60
          orientation: "vertical"
          padding: [10, 5, 10, 5]
          canvas.before:
            Color:
              rgba: hex("#AAAAAA")
            Line:
              width: 0.5
              rectangle: self.x, self.y, self.width, self.height

          MDLabel:
            size_hint: [1, None]
            height: 20
            font_style: "Body2"
            theme_text_color: "Custom"
            text_color: hex("#607D8B")
            markup: True
            text: "Customer Name [color=#EA4335]*[/color]"

          TextInput:
            size_hint: [1, 1]
            multiline: False
            font_size: 18
            border: [0, 0, 0, 0]
            padding: [0, 5, 0, 0]
            background_normal: ""
            background_active: ""
            cursor_width: 2
            cursor_color: app.theme_cls.primary_color
            write_tab: False

        BoxLayout:
          size_hint: [1, None]
          height: 60
          orientation: "vertical"
          padding: [10, 5, 10, 5]
          canvas.before:
            Color:
              rgba: hex("#AAAAAA")
            Line:
              width: 0.5
              rectangle: self.x, self.y, self.width, self.height

          MDLabel:
            size_hint: [1, None]
            height: 20
            font_style: "Body2"
            theme_text_color: "Custom"
            text_color: hex("#607D8B")
            markup: True
            text: "ID Card [color=#EA4335]*[/color]"

          TextInput:
            size_hint: [1, 1]
            multiline: False
            font_size: 18
            border: [0, 0, 0, 0]
            padding: [0, 5, 0, 0]
            background_normal: ""
            background_active: ""
            cursor_width: 2
            cursor_color: app.theme_cls.primary_color
            write_tab: False

      BoxLayout:
        size_hint: [1, None]
        height: 60

        BoxLayout:
          size_hint: [1, None]
          height: 60
          orientation: "vertical"
          padding: [10, 5, 10, 5]
          canvas.before:
            Color:
              rgba: hex("#AAAAAA")
            Line:
              width: 0.5
              rectangle: self.x, self.y, self.width, self.height

          MDLabel:
            size_hint: [1, None]
            height: 20
            font_style: "Body2"
            theme_text_color: "Custom"
            text_color: hex("#607D8B")
            markup: True
            text: "Phone"

          TextInput:
            size_hint: [1, 1]
            multiline: False
            font_size: 18
            border: [0, 0, 0, 0]
            padding: [0, 5, 0, 0]
            background_normal: ""
            background_active: ""
            cursor_width: 2
            cursor_color: app.theme_cls.primary_color
            write_tab: False

        BoxLayout:
          size_hint: [1, None]
          height: 60
          orientation: "vertical"
          padding: [10, 5, 10, 5]
          canvas.before:
            Color:
              rgba: hex("#AAAAAA")
            Line:
              width: 0.5
              rectangle: self.x, self.y, self.width, self.height

          MDLabel:
            size_hint: [1, None]
            height: 20
            font_style: "Body2"
            theme_text_color: "Custom"
            text_color: hex("#607D8B")
            markup: True
            text: "Account Number [color=#EA4335]*[/color]"

          TextInput:
            size_hint: [1, 1]
            multiline: False
            font_size: 18
            border: [0, 0, 0, 0]
            padding: [0, 5, 0, 0]
            background_normal: ""
            background_active: ""
            cursor_width: 2
            cursor_color: app.theme_cls.primary_color
            write_tab: False

      MDLabel:
        size_hint: [1, None]
        font_style: "H6"
        height: 60
        text_size: (None, None)
        markup: True
        text: "[u]Receiver Information[/u]"

      BoxLayout:
        size_hint: [1, None]
        height: 30

        BoxLayout:
          size_hint: [0.25, 1]

          MDCheckbox:
            size_hint: [None, None]
            size: (40, 40)
            pos_hint: {"center_y": .5}

          MDLabel:
            size_hint: [1, None]
            height: 30
            pos_hint: {"center_y": .5}
            theme_text_color: "Custom"
            text_color: hex("#607D8B")
            text: "Within Bank"

        BoxLayout:
          size_hint: [0.25, 1]

          MDCheckbox:
            size_hint: [None, None]
            size: (40, 40)
            pos_hint: {"center_y": .5}

          MDLabel:
            size_hint: [1, None]
            height: 30
            pos_hint: {"center_y": .5}
            theme_text_color: "Custom"
            text_color: hex("#607D8B")
            text: "Self Receive"

        BoxLayout:
          size_hint: [0.5, 1]

      BoxLayout:
        size_hint: [1, None]
        height: 70

        BoxLayout:
          size_hint: [1, None]
          height: 60
          orientation: "vertical"
          padding: [10, 5, 10, 5]
          canvas.before:
            Color:
              rgba: hex("#AAAAAA")
            Line:
              width: 0.5
              rectangle: self.x, self.y, self.width, self.height

          MDLabel:
            size_hint: [1, None]
            height: 20
            font_style: "Body2"
            theme_text_color: "Custom"
            text_color: hex("#607D8B")
            markup: True
            text: "Inter-bank [color=#EA4335]*[/color]"

          TextInput:
            size_hint: [1, 1]
            multiline: False
            font_size: 18
            border: [0, 0, 0, 0]
            padding: [0, 5, 0, 0]
            background_normal: ""
            background_active: ""
            cursor_width: 2
            cursor_color: app.theme_cls.primary_color
            write_tab: False

        BoxLayout:
          size_hint: [1, None]
          height: 60
          orientation: "vertical"
          padding: [10, 5, 10, 5]
          canvas.before:
            Color:
              rgba: hex("#AAAAAA")
            Line:
              width: 0.5
              rectangle: self.x, self.y, self.width, self.height

          MDLabel:
            size_hint: [1, None]
            height: 20
            font_style: "Body2"
            theme_text_color: "Custom"
            text_color: hex("#607D8B")
            markup: True
            text: "Province/City [color=#EA4335]*[/color]"

          TextInput:
            size_hint: [1, 1]
            multiline: False
            font_size: 18
            border: [0, 0, 0, 0]
            padding: [0, 5, 0, 0]
            background_normal: ""
            background_active: ""
            cursor_width: 2
            cursor_color: app.theme_cls.primary_color
            write_tab: False

      BoxLayout:
        size_hint: [1, None]
        height: 60

        BoxLayout:
          size_hint: [1, None]
          height: 60
          orientation: "vertical"
          padding: [10, 5, 10, 5]
          canvas.before:
            Color:
              rgba: hex("#AAAAAA")
            Line:
              width: 0.5
              rectangle: self.x, self.y, self.width, self.height

          MDLabel:
            size_hint: [1, None]
            height: 20
            font_style: "Body2"
            theme_text_color: "Custom"
            text_color: hex("#607D8B")
            markup: True
            text: "Receiver Name [color=#EA4335]*[/color]"

          TextInput:
            size_hint: [1, 1]
            multiline: False
            font_size: 18
            border: [0, 0, 0, 0]
            padding: [0, 5, 0, 0]
            background_normal: ""
            background_active: ""
            cursor_width: 2
            cursor_color: app.theme_cls.primary_color
            write_tab: False

        BoxLayout:
          size_hint: [1, None]
          height: 60
          orientation: "vertical"
          padding: [10, 5, 10, 5]
          canvas.before:
            Color:
              rgba: hex("#AAAAAA")
            Line:
              width: 0.5
              rectangle: self.x, self.y, self.width, self.height

          MDLabel:
            size_hint: [1, None]
            height: 20
            font_style: "Body2"
            theme_text_color: "Custom"
            text_color: hex("#607D8B")
            markup: True
            text: "Account Number [color=#EA4335]*[/color]"

          TextInput:
            size_hint: [1, 1]
            multiline: False
            font_size: 18
            border: [0, 0, 0, 0]
            padding: [0, 5, 0, 0]
            background_normal: ""
            background_active: ""
            cursor_width: 2
            cursor_color: app.theme_cls.primary_color
            write_tab: False

      BoxLayout:
        size_hint: [1, None]
        height: 60

        BoxLayout:
          size_hint: [1, None]
          height: 60
          orientation: "vertical"
          padding: [10, 5, 10, 5]
          canvas.before:
            Color:
              rgba: hex("#AAAAAA")
            Line:
              width: 0.5
              rectangle: self.x, self.y, self.width, self.height

          MDLabel:
            size_hint: [1, None]
            height: 20
            font_style: "Body2"
            theme_text_color: "Custom"
            text_color: hex("#607D8B")
            markup: True
            text: "Phone"

          TextInput:
            size_hint: [1, 1]
            multiline: False
            font_size: 18
            border: [0, 0, 0, 0]
            padding: [0, 5, 0, 0]
            background_normal: ""
            background_active: ""
            cursor_width: 2
            cursor_color: app.theme_cls.primary_color
            write_tab: False

        BoxLayout:
          size_hint: [1, None]
          height: 60
          orientation: "vertical"
          padding: [10, 5, 10, 5]
          canvas.before:
            Color:
              rgba: hex("#AAAAAA")
            Line:
              width: 0.5
              rectangle: self.x, self.y, self.width, self.height

          MDLabel:
            size_hint: [1, None]
            height: 20
            font_style: "Body2"
            theme_text_color: "Custom"
            text_color: hex("#607D8B")
            markup: True
            text: "Amount (VND) [color=#EA4335]*[/color]"

          TextInput:
            size_hint: [1, 1]
            multiline: False
            font_size: 18
            border: [0, 0, 0, 0]
            padding: [0, 5, 0, 0]
            background_normal: ""
            background_active: ""
            cursor_width: 2
            cursor_color: app.theme_cls.primary_color
            write_tab: False

      BoxLayout:
        size_hint: [1, None]
        height: 100

        BoxLayout:
          size_hint: [1, None]
          height: 100
          orientation: "vertical"
          padding: [10, 5, 10, 5]
          canvas.before:
            Color:
              rgba: hex("#AAAAAA")
            Line:
              width: 0.5
              rectangle: self.x, self.y, self.width, self.height

          MDLabel:
            size_hint: [1, None]
            height: 20
            font_style: "Body2"
            theme_text_color: "Custom"
            text_color: hex("#607D8B")
            markup: True
            text: "Remark"

          TextInput:
            size_hint: [1, 1]
            font_size: 18
            border: [0, 0, 0, 0]
            padding: [0, 5, 0, 0]
            background_normal: ""
            background_active: ""
            cursor_width: 2
            cursor_color: app.theme_cls.primary_color
            write_tab: False

      BoxLayout:
        size_hint: [1, None]
        height: 60

        BoxLayout:
          size_hint: [1, None]

        BoxLayout:
          size_hint: [None, 1]
          width: 200

          MDRectangleFlatButton:
            size_hint: [1, None]
            height: 30
            text: "DONE"
            on_release:
              root.complete_session_task()

<KSheetsScrollView>:
  size_hint: 1, 1
  do_scroll_y: False
  bar_color: 0, 0, 0, 0
  bar_inactive_color: 0, 0, 0, 0
  bar_width: 0

<KSheetsMain>:
  scroll_type: ["bars", "content"]

<TaskSheets>:
  bar: sheetsbar
  main: maincontent
  anchor_y: "top"

  BoxLayout:
    orientation: "vertical"

    KSheetsBar:
      id: sheetsbar
      scrollview: scrollview
      layout: layout
      size_hint: [1, None]
      height: 50

      canvas.before:
        Color:
          rgba: hex("#B0BEC5")
        Rectangle:
          pos: self.pos
          size: self.size

      ScrollView:
        id: scrollview

        KSheetsGridLayout:
          id: layout
          spacing: 1
          rows: 1
          size_hint_y: 1
          adaptive_width: True

    KSheetsMain:
      id: maincontent
      size_hint: [1, 1]

<SessionScreen@Screen>:
  name: "session_screen"

  BoxLayout:
    orientation: "vertical"

    BoxLayout:
      size_hint: [1, 0.1]
      padding: [5, 0, 5, 5]

      MDLabel:
        size_hint: [0.8, 1]
        font_size: 35
        text_size: (None, None)
        markup: True
        text: "[color=#607D8B]ESMS[/color][color=#888888][size=28] Workspace[/size][/color]"

      BoxLayout:
        size_hint: [0.2, 1]

      CompleteSessionButton:
        size_hint: [None, None]
        pos_hint: {"center_y": 0.5}
        icon: "progress-check"
        text: "COMPLETE SESSION"

    BoxLayout:
      spacing: 5
      size_hint: [1, 0.9]
      padding: [5, 0, 5, 5]

      BoxLayout:
        spacing: 5
        orientation: "vertical"
        size_hint: [0.2, 1]

        BoxLayout:
          size_hint: [1, 0.3]

          canvas.before:
            Color:
              rgba: hex("#607D8B")
            Line:
              width: 0.5
              rectangle: self.x, self.y, self.width, self.height

          BoxLayout:
            size_hint: [0.05, 1]

          BoxLayout:
            orientation: "vertical"
            size_hint: [0.9, 0.9]
            pos_hint: {"center_y": 0.5}

            canvas.before:
              Color:
                rgba: hex(app.emotion_color)
              Line:
                width: 1.5
                rectangle: self.x - 1, self.y - 3, self.width + 2, self.height + 6

            CameraImage:
              source: "assets/video.jpg"
              pos_hint: {"center_x": 0.5, "center_y": 0.5}
              allow_stretch: True
              anim_delay: 0.05
              nocache: True

          BoxLayout:
            size_hint: [0.05, 1]

        BoxLayout:
          size_hint: [1, 0.7]

          canvas.before:
            Color:
              rgba: hex("#607D8B")
            Line:
              width: 0.5
              rectangle: self.x, self.y, self.width, self.height

          BoxLayout:
            orientation: "vertical"

            BoxLayout:
              size_hint: [1, 0.1]
              canvas.before:
                Color:
                  rgba: hex("#AAAAAA")
                Rectangle:
                  pos: self.pos
                  size: self.size

              BoxLayout:
                size_hint: [None, 1]
                width: 20

              MDLabel:

                font_size: 20
                text_size: (None, None)
                markup: True
                text: "[color=#FFFFFF]Available Tasks[/color]"

            BoxLayout:
              size_hint: [1, 0.9]

              ScrollView:
                scroll_type: ["bars", "content"]

                CategoryList:
                  padding: 0

      BoxLayout:
        size_hint: [0.8, 1]

        canvas.before:
          Color:
            rgba: hex("#607D8B")
          Line:
            width: 0.5
            rectangle: self.x, self.y, self.width, self.height

        TaskSheets:

<SessionResultContent>:
  size_hint: [None, None]
  width: 800
  height: 400
  orientation: "vertical"

  BoxLayout:
    size_hint: [1, None]
    height: 80

    BoxLayout:
      size_hint: [1, None]
      height: 60
      orientation: "vertical"
      padding: [10, 5, 10, 5]
      canvas.before:
        Color:
          rgba: hex("#AAAAAA")
        Line:
          width: 0.5
          rectangle: self.x, self.y, self.width, self.height

      MDLabel:
        font_style: "Body2"
        theme_text_color: "Custom"
        text_color: hex("#607D8B")
        markup: True
        text: "[u]Total Session duration:[/u]"

      MDLabel:
        font_size: 18
        text: app.ms_to_str(app.session_result_map["total_session_duration"]) if app.session_result_map is not None else "0"

  BoxLayout:
    size_hint: [1, None]
    height: 60

    BoxLayout:
      size_hint: [1, None]
      height: 60
      orientation: "vertical"
      padding: [10, 5, 10, 5]
      canvas.before:
        Color:
          rgba: hex("#AAAAAA")
        Line:
          width: 0.5
          rectangle: self.x, self.y, self.width, self.height

      MDLabel:
        font_style: "Body2"
        theme_text_color: "Custom"
        text_color: hex("#607D8B")
        markup: True
        text: "[u]Total Negative expression duration:[/u]"

      MDLabel:
        font_size: 18
        text: app.ms_to_str(app.session_result_map["negative_emotions_duration"]) if app.session_result_map is not None else "0"

    BoxLayout:
      size_hint: [1, None]
      height: 60
      orientation: "vertical"
      padding: [10, 5, 10, 5]
      canvas.before:
        Color:
          rgba: hex("#AAAAAA")
        Line:
          width: 0.5
          rectangle: self.x, self.y, self.width, self.height

      MDLabel:
        font_style: "Body2"
        theme_text_color: "Custom"
        text_color: hex("#607D8B")
        markup: True
        text: "[u]Total Neutral expression duration:[/u]"

      MDLabel:
        font_size: 18
        text: app.ms_to_str(app.session_result_map["neutral_emotions_duration"]) if app.session_result_map is not None else "0"

    BoxLayout:
      size_hint: [1, None]
      height: 60
      orientation: "vertical"
      padding: [10, 5, 10, 5]
      canvas.before:
        Color:
          rgba: hex("#AAAAAA")
        Line:
          width: 0.5
          rectangle: self.x, self.y, self.width, self.height

      MDLabel:
        font_style: "Body2"
        theme_text_color: "Custom"
        text_color: hex("#607D8B")
        markup: True
        text: "[u]Total Positive expression duration:[/u]"

      MDLabel:
        font_size: 18
        text: app.ms_to_str(app.session_result_map["positive_emotions_duration"]) if app.session_result_map is not None else "0"

  BoxLayout:
    size_hint: [1, None]
    height: 60

    BoxLayout:
      size_hint: [1, None]
      height: 60
      orientation: "vertical"
      padding: [10, 5, 10, 5]
      canvas.before:
        Color:
          rgba: hex("#AAAAAA")
        Line:
          width: 0.5
          rectangle: self.x, self.y, self.width, self.height

      MDLabel:
        font_style: "Body2"
        theme_text_color: "Custom"
        text_color: hex("#607D8B")
        markup: True
        text: "[u]Angry warning count:[/u]"

      MDLabel:
        font_size: 18
        text: str(app.session_result_map["angry_warning"]) if app.session_result_map is not None else "0"

    BoxLayout:
      size_hint: [1, None]
      height: 60
      orientation: "vertical"
      padding: [10, 5, 10, 5]
      canvas.before:
        Color:
          rgba: hex("#AAAAAA")
        Line:
          width: 0.5
          rectangle: self.x, self.y, self.width, self.height

      MDLabel:
        font_style: "Body2"
        theme_text_color: "Custom"
        text_color: hex("#607D8B")
        markup: True
        text: "[u]Max Angry expression duration:[/u]"

      MDLabel:
        font_size: 18
        text: app.ms_to_str(app.session_result_map["angry_duration_warning_max"]) if app.session_result_map is not None else "0"

  BoxLayout:
    size_hint: [1, None]
    height: 60

    BoxLayout:
      size_hint: [1, None]
      height: 60
      orientation: "vertical"
      padding: [10, 5, 10, 5]
      canvas.before:
        Color:
          rgba: hex("#AAAAAA")
        Line:
          width: 0.5
          rectangle: self.x, self.y, self.width, self.height

      MDLabel:
        font_style: "Body2"
        theme_text_color: "Custom"
        text_color: hex("#607D8B")
        markup: True
        text: "[u]Leaving the working space warning count:[/u]"

      MDLabel:
        font_size: 18
        text: str(app.session_result_map["no_face_detected_warning"]) if app.session_result_map is not None else "0"

    BoxLayout:
      size_hint: [1, None]
      height: 60
      orientation: "vertical"
      padding: [10, 5, 10, 5]
      canvas.before:
        Color:
          rgba: hex("#AAAAAA")
        Line:
          width: 0.5
          rectangle: self.x, self.y, self.width, self.height

      MDLabel:
        font_style: "Body2"
        theme_text_color: "Custom"
        text_color: hex("#607D8B")
        markup: True
        text: "[u]Max Leaving the working space duration:[/u]"

      MDLabel:
        font_size: 18
        text: app.ms_to_str(app.session_result_map["no_face_detected_duration_warning_max"]) if app.session_result_map is not None else "0"

  BoxLayout:
    size_hint: [1, None]
    height: 100

    BoxLayout:
      size_hint: [1, None]
      height: 100
      orientation: "vertical"
      padding: [10, 5, 10, 5]
      canvas.before:
        Color:
          rgba: hex("#AAAAAA")
        Line:
          width: 0.5
          rectangle: self.x, self.y, self.width, self.height

      MDLabel:
        font_style: "Body1"
        theme_text_color: "Custom"
        text_color: hex("#607D8B")
        markup: True
        text: "[u]Overview Emotion Expression:[/u]"

      MDLabel:
        font_size: 30
        theme_text_color: "Custom"
        text_color: hex("#34A853") if app.session_result_map is not None and app.session_result_map["emotion_level"] > 0 else (hex("#EA4335") if app.session_result_map is not None and app.session_result_map["emotion_level"] < 0 else hex("#4285F4"))
        text: "Positive" if app.session_result_map is not None and app.session_result_map["emotion_level"] > 0 else ("Negative" if app.session_result_map is not None and app.session_result_map["emotion_level"] < 0 else "Neutral")

  BoxLayout:
    size_hint: [1, 1]
